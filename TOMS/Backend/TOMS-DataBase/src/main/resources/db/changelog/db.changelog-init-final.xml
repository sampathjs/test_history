<?xml version="1.0" encoding="UTF-8"?> 
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:pro="http://www.liquibase.org/xml/ns/pro" 
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd
		http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-3.8.xsd"> 
  
  <changeSet author="Jens Waechter" id="Schema Init Finalisation">

	<!--  reference type -->
	<createIndex indexName="i_reference_type_id" tableName="reference_type" unique="true">
      <column name="reference_type_id"/>
    </createIndex>

	<createIndex indexName="i_reference_type_name" tableName="reference_type" unique="true">
      <column name="name"/>
    </createIndex>

	<!--  reference  -->
	<createIndex indexName="i_reference_id" tableName="reference" unique="true">
      <column name="reference_id"/>
    </createIndex>

	<createIndex indexName="i_reference_type_value" tableName="reference" unique="true">
      <column name="reference_type_id"/>
      <column name="value"/>
    </createIndex>
    
    <addUniqueConstraint  
            tableName="reference"
            columnNames="reference_type_id, value"  
            constraintName="unique_constraint_reference"
            validate="true"/>  

	<!--  Attribute Calculation -->
	<createIndex indexName="i_attribute_calc_id" tableName="attribute_calc" unique="true">
      <column name="attribute_calc_id"/>
    </createIndex>

	<createIndex indexName="i_attribute_calc_class_attribute" tableName="attribute_calc" unique="true">
      <column name="class_name"/>
      <column name="attribute_name"/>
    </createIndex>

	<createIndex indexName="i_attribute_calc_attributes" tableName="attribute_calc_attributes" unique="true">
      <column name="attribute_calc_id"/>
    </createIndex>
    
    <addUniqueConstraint  
            tableName="attribute_calc"
            columnNames="class_name,attribute_name"  
            constraintName="unique_constraint_attribute_calc"
            validate="true"/>
            
    <!-- Expiration Status  -->
  	<createIndex indexName="i_expiration_status_id" tableName="expiration_status" unique="true">
      <column name="expiration_status_id"/>
    </createIndex>

  	<createIndex indexName="i_expiration_status_name_reference" tableName="expiration_status" unique="false">
      <column name="name_reference_id"/>
    </createIndex>

    <addUniqueConstraint  
            tableName="expiration_status"
            columnNames="name_reference_id,order_type_reference_id"  
            constraintName="unique_constraint_expiration_status"
            validate="true"/>
    
    <!-- Order Status  -->
  	<createIndex indexName="i_order_status_id" tableName="order_status" unique="true">
      <column name="order_status_id"/>
    </createIndex>

  	<createIndex indexName="i_order_status_name_reference" tableName="order_status" unique="false">
      <column name="name_reference_id"/>
    </createIndex>

    <addUniqueConstraint  
            tableName="order_status"
            columnNames="name_reference_id,order_type_reference_id"  
            constraintName="unique_constraint_order_status"
            validate="true"/>    
            
    <!-- Process Transition -->
  	<createIndex indexName="i_process_transition_id" tableName="process_transition" unique="true">
      <column name="process_transition_id"/>
    </createIndex>
    
  	<createIndex indexName="i_process_transition_category" tableName="process_transition" unique="false">
      <column name="reference_category_id"/>
    </createIndex>

  	<createIndex indexName="i_process_transition_attributes" tableName="process_transition_attributes" unique="false">
      <column name="process_transition_id"/>
    </createIndex>
    
    <addUniqueConstraint  
         tableName="process_transition"
         columnNames="reference_category_id,from_status_id,to_status_id"  
         constraintName="unique_constraint_process_transition"
         validate="true"/>
         
    <!--  Party -->
    <createIndex indexName="i_party_id" tableName="party" unique="true">
      <column name="party_id"/>
    </createIndex>  

    <createIndex indexName="i_party_type" tableName="party" unique="false">
      <column name="reference_party_type_id"/>
    </createIndex>  

    <addUniqueConstraint  
         tableName="party"
         columnNames="reference_party_type_id,name"  
         constraintName="unique_constraint_party"
         validate="true"/>
         
    <!-- user -->
    <createIndex indexName="i_user_id" tableName="user" unique="true">
      <column name="user_id"/>
    </createIndex>  
    
    <createIndex indexName="i_user_active" tableName="user" unique="false">
      <column name="active"/>
    </createIndex>  

    <createIndex indexName="i_user_role_id" tableName="user" unique="false">
      <column name="role_id"/>
    </createIndex>
	
	  <!-- Index -->
  	<createIndex indexName="i_index_id" tableName="index" unique="true">
    	<column name="index_id"/>
  	</createIndex>

  	<createIndex indexName="i_index_name" tableName="index" unique="true">
    	<column name="reference_index_name_id"/>
  	</createIndex>
  	
  	<!--  Order Comment -->
  	<createIndex indexName="i_order_comment_id" tableName="order_comment" unique="true">
    	<column name="order_comment_id"/>
  	</createIndex>
  	
  	<!-- Credit Check -->
   	<createIndex indexName="i_credit_check_id" tableName="credit_check" unique="true">
    	<column name="credit_check_id"/>
  	</createIndex>
  	
   	<createIndex indexName="i_credit_check_party" tableName="credit_check" unique="false">
    	<column name="party_id"/>
  	</createIndex>
  	
  </changeSet> 
    
</databaseChangeLog>
